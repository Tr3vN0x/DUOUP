<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DUO Up</title>
<link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
  body { margin:0; font-family:'Orbitron',sans-serif; background:linear-gradient(270deg,#0D0D0D,#1A1A1A,#0D0D0D); background-size:600% 600%; animation:gradientAnimation 15s ease infinite; color:white; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; }
  @keyframes gradientAnimation { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
  .hidden{ display:none; }
  .neon-btn{ padding:10px 20px; font-family:'Orbitron',sans-serif; font-weight:bold; color:white; background:transparent; border:2px solid #00FFFF; border-radius:6px; cursor:pointer; box-shadow:0 0 5px #00FFFF,0 0 10px #00FFFF,0 0 20px #00FFFF; transition:0.3s; margin:5px; }
  .neon-btn:hover{ border-color:#FF00FF; box-shadow:0 0 10px #FF00FF,0 0 20px #FF00FF,0 0 30px #FF00FF; }
  input{ padding:10px; border-radius:6px; border:2px solid #00FFFF; background:transparent; color:white; width:250px; margin:10px 0; }
</style>
</head>
<body>

<!-- Login Page -->
<div id="loginPage">
  <h1>DUO Up</h1>
  <button class="neon-btn" onclick="loginWithGoogle()">Login with Google</button>
</div>

<!-- Pick Username Page -->
<div id="pickUsernamePage" class="hidden">
  <h2>Pick Your Username</h2>
  <input type="text" id="usernameInput" placeholder="Enter username">
  <button class="neon-btn" onclick="saveUsername()">Submit</button>
  <button class="neon-btn" onclick="logout()">Logout</button>
</div>

<!-- Dashboard Page -->
<div id="dashboardPage" class="hidden">
  <div style="display:flex; align-items:center; gap:15px;">
    <span id="welcomeUsername">Welcome, Gamer</span>
    <button class="neon-btn" onclick="logout()">Logout</button>
  </div>
  <h2>Dashboard Content Goes Here</h2>
</div>

<script>
  const firebaseConfig = {
    apiKey:"AIzaSyDVHxatohLvJNqIHXjf1ZXdmmWX5W1EpNw",
    authDomain:"duoup-cfae6.firebaseapp.com",
    projectId:"duoup-cfae6",
    storageBucket:"duoup-cfae6.firebasestorage.app",
    messagingSenderId:"812263060524",
    appId:"1:812263060524:web:ac09c3ae610db1cd110d89",
    measurementId:"G-46B67F90FK"
  };
  firebase.initializeApp(firebaseConfig);
  const auth=firebase.auth();
  const db=firebase.firestore();

  const loginPage=document.getElementById("loginPage");
  const pickUsernamePage=document.getElementById("pickUsernamePage");
  const dashboardPage=document.getElementById("dashboardPage");

  function loginWithGoogle(){
    const provider=new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).then(result=>{
      checkUsername(result.user);
    });
  }

  function checkUsername(user){
    const userRef=db.collection("users").doc(user.uid);
    userRef.get().then(doc=>{
      if(doc.exists && doc.data().username){
        // User has username → dashboard
        loginPage.classList.add("hidden");
        pickUsernamePage.classList.add("hidden");
        dashboardPage.classList.remove("hidden");
        document.getElementById("welcomeUsername").innerText="Welcome, "+doc.data().username;
      } else {
        // No username → pick username page
        loginPage.classList.add("hidden");
        pickUsernamePage.classList.remove("hidden");
      }
    });
  }

  function saveUsername(){
    const username=document.getElementById("usernameInput").value;
    if(!username) return alert("Enter a username");
    const user=auth.currentUser;
    db.collection("users").doc(user.uid).set({
      username:username,
      email:user.email,
      profileImageUrl:user.photoURL,
      isPremium:false,
      status:"online",
      createdAt:firebase.firestore.FieldValue.serverTimestamp()
    },{merge:true}).then(()=>{
      pickUsernamePage.classList.add("hidden");
      dashboardPage.classList.remove("hidden");
      document.getElementById("welcomeUsername").innerText="Welcome, "+username;
    });
  }

  function logout(){
    auth.signOut().then(()=>{
      loginPage.classList.remove("hidden");
      pickUsernamePage.classList.add("hidden");
      dashboardPage.classList.add("hidden");
    });
  }

  // Auto check if user already logged in
  auth.onAuthStateChanged(user=>{
    if(user){
      checkUsername(user);
    } else {
      loginPage.classList.remove("hidden");
      pickUsernamePage.classList.add("hidden");
      dashboardPage.classList.add("hidden");
    }
  });
</script>

</body>
</html>
