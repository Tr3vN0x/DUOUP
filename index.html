<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr3vMedia Neon Swipe Interface (Profile View)</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        /* --- NEON LED THEME STYLES --- */
        :root {
            --bg-dark: #0F1117;
            --neon-green: #00FF66;
            --neon-glow: 0 0 8px var(--neon-green), 0 0 15px var(--neon-green);
            --card-bg: #1B1E28;
            --text-light: #E0E0E0;
            --secondary-dark: #12151d;
        }

        body {
            font-family: 'Share Tech Mono', monospace, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Allow body to grow past viewport height */
            min-height: 100vh; 
            background-color: var(--bg-dark);
            color: var(--neon-green);
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-shadow: var(--neon-glow);
            margin-bottom: 30px;
            font-size: 2em;
        }

        /* --- CARD & SWIPE STYLES --- */
        .swipe-area {
            display: flex;
            gap: 50px;
            align-items: flex-start; /* Align top of swipe deck and console */
            margin-bottom: 50px;
        }

        .swipe-container {
            position: relative;
            width: 320px;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: var(--card-bg);
            border-radius: 12px;
            border: 2px solid var(--neon-green);
            box-shadow: 0 0 10px rgba(0, 255, 102, 0.5);
            overflow: hidden;
            cursor: grab;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            will-change: transform, opacity;
            display: flex;
            flex-direction: column;
            text-align: center;
        }
        
        .card-header {
            position: absolute; top: 20px; left: -45px; width: 200px; padding: 5px 0;
            background-color: rgba(0, 255, 102, 0.8); color: var(--bg-dark);
            text-align: center; font-size: 0.9em; font-weight: bold; letter-spacing: 1px;
            transform: rotate(-45deg); transform-origin: 0 0; z-index: 10;
        }

        /* --- PROFILE CONSOLE STYLES (NEW) --- */
        .profile-console {
            width: 450px;
            min-height: 500px;
            background-color: var(--secondary-dark);
            border: 2px solid var(--neon-green);
            box-shadow: var(--neon-glow);
            padding: 20px;
            border-radius: 12px;
            color: var(--text-light);
        }
        .console-title {
            font-size: 1.5em;
            text-shadow: 0 0 5px var(--neon-green);
            border-bottom: 1px dashed var(--neon-green);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
        }
        .my-card-static {
            width: 100%;
            height: 150px; /* Shorter display for static profile view */
            border: 1px solid var(--neon-green);
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--card-bg);
            display: flex;
            margin-bottom: 20px;
        }
        .my-card-static img {
            width: 40%;
            height: 100%;
            object-fit: cover;
        }
        .my-card-info {
            width: 60%;
            padding: 10px;
            text-align: left;
            font-size: 0.85em;
        }
        .match-list-title {
            color: var(--neon-green);
            margin: 15px 0 10px 0;
            font-weight: bold;
        }
        .match-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px dotted rgba(0, 255, 102, 0.3);
            font-size: 0.9em;
        }
        .match-percent {
            color: var(--neon-green);
            font-weight: bold;
            text-shadow: 0 0 3px var(--neon-green);
        }
        .bio-area {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed var(--neon-green);
        }
        .bio-area textarea {
            width: calc(100% - 22px);
            height: 60px;
            padding: 10px;
            background: var(--bg-dark);
            border: 1px solid var(--neon-green);
            color: var(--neon-green);
            border-radius: 4px;
            margin-top: 5px;
            margin-bottom: 10px;
            resize: none;
        }
        .generate-btn {
            background-color: #333;
            border-color: #ccc;
        }
        .generate-btn:hover {
            background-color: var(--neon-green);
            color: var(--bg-dark);
        }

    </style>
</head>
<body>

    <header>
        <h1>TR3VMEDIA // ENGAGE</h1>
        <button id="customizeBtn" class="ui-button">‚öôÔ∏è Customize Card</button>
        <button id="loginBtn" class="ui-button">üîì Login/Logout</button>
    </header>

    <div class="swipe-area">
        <div class="swipe-column">
            <div class="swipe-container">
                <div id="noMoreCards">
                    NO MORE MEDIA. REBOOTING SEQUENCE...
                </div>
            </div>
            <div class="controls">
                <button id="dislikeBtn">‚ùå SKIP</button>
                <button id="likeBtn">‚ù§Ô∏è ENGAGE</button>
            </div>
        </div>

        <div id="profileConsole" class="profile-console">
            </div>
    </div>


    <div id="loginModal" class="modal-overlay" style="display: none;"><div class="modal-content"><h2 id="loginTitle">System Login</h2><form id="loginForm"><label for="username">User Handle:</label><input type="text" id="username" value="tr3vmedia" required><label for="password">Password (Mock):</label><input type="text" id="password" value="pass123" required><div class="modal-actions"><button type="submit" class="ui-button">Access System</button><button type="button" class="ui-button" onclick="closeLoginModal()">Abort</button></div></form><div id="logoutSection" style="display: none;"><p>Logged in as: <strong id="loggedInUser"></strong></p><div class="modal-actions"><button type="button" class="ui-button" onclick="logout()">Terminate Session</button></div></div></div></div>
    <div id="customizeModal" class="modal-overlay" style="display: none;"><div class="modal-content"><h2>Customize Your Card</h2><p style="color: red;">* Requires mock login to save changes.</p><form id="cardCustomizationForm"><label for="cardBirthday">Date of Birth (Sets Age):</label><input type="date" id="cardBirthday" max="2007-01-01" required><label for="cardTitle">Project Title:</label><input type="text" id="cardTitle" maxlength="30" required><label for="cardDesc">Description (Max 50 chars):</label><textarea id="cardDesc" maxlength="50" required></textarea><label for="cardMedia">Media URL (Placeholder):</label><input type="text" id="cardMedia" placeholder="https://picsum.photos/320/280?user=..." required> <div class="modal-actions"><button type="submit" class="ui-button">üíæ SAVE CARD</button><button type="button" class="ui-button" onclick="closeCustomizeModal()">CANCEL</button></div></form></div></div>
    <div id="mediaViewerModal" class="modal-overlay" style="display: none;"><div class="modal-content"><h2 id="viewerTitle">Loading Media...</h2><div class="media-container"></div><div id="viewerDescription" style="color: var(--text-light); margin-bottom: 20px;"></div><div class="viewer-nav-controls"><button id="prevMediaBtn" class="ui-button" disabled>‚ùÆ Previous</button><button id="nextMediaBtn" class="ui-button" disabled>Next ‚ùØ</button></div><div class="modal-actions"><button type="button" class="ui-button" onclick="closeMediaViewer()">CLOSE VIEWER</button></div></div></div>


    <script>
        // --- JAVASCRIPT LOGIC ---

        // NEW: Mock data for users who have engaged with the card
        const MOCK_ENGAGEMENTS = [
            { user: "@cyber_punk", match: 85, media: "Film" },
            { user: "@neon_dreams", match: 62, media: "Photo" },
            { user: "@trance_code", match: 51, media: "Music" },
        ];

        // DELETE ALL FAKE CARDS. Only user card exists.
        let CARD_DATA = []; 
        
        // --- AGE CALCULATION FUNCTION (Unchanged) ---
        function calculateAge(birthday) {
            const birthDate = new Date(birthday);
            const today = new Date();
            if (isNaN(birthDate)) return 'N/A';
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDifference = today.getMonth() - birthDate.getMonth();
            if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return (age >= 0 && age < 120) ? age : 'N/A';
        }

        // --- GLOBAL STATE ---
        let viewerHistory = [];
        let viewerHistoryIndex = -1;
        const swipeContainer = document.querySelector('.swipe-container');
        const profileConsole = document.getElementById('profileConsole');
        let currentCardIndex = 0;
        let isUserLoggedIn = false;
        
        // Custom user card now includes a 'bio' field
        let userCardData = JSON.parse(localStorage.getItem('userCard')) || {
            id: 'user_custom', title: "My Custom Media Card", user: localStorage.getItem('userHandle') || "@Guest", 
            birthday: '2000-01-01', 
            description: "Customize this description in the modal!", bio: "A visual artist focused on neon cityscapes and synthwave aesthetics.",
            imageUrl: "https://picsum.photos/320/280?user=tr3vmedia",
            mediaType: 'image', fullUrl: 'https://picsum.photos/600/400?user=tr3vmedia'
        };


        // --- 1. CARD RENDERING (Unchanged) ---

        function getCardAge(data) {
            if (data.birthday) { return calculateAge(data.birthday); }
            return data.age || 'N/A';
        }

        function createCard(data) {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.id = data.id;
            const ageDisplay = getCardAge(data);

            card.innerHTML = `
                <div class="card-header">${data.user.toUpperCase()}, ${ageDisplay}</div>
                <img class="card-image" src="${data.imageUrl}" alt="${data.title}">
                <div class="card-info">
                    <h3>${data.title.toUpperCase()}</h3>
                    <p>${data.description}</p>
                </div>
            `;
            return card;
        }

        function loadNextCard() {
            if (swipeContainer.children.length === 0) {
                 // ONLY LOAD USER CARD: This executes exactly once
                const userCard = createCard(userCardData);
                swipeContainer.appendChild(userCard);
                addSwipeListeners(userCard);
                document.getElementById('noMoreCards').style.display = 'none';
                currentCardIndex = 1; 
            } else if (swipeContainer.children.length === 1 && swipeContainer.children[0].className === 'card') {
                 // The user card was swiped, now show the "No More Cards" message
                document.getElementById('noMoreCards').style.display = 'block';
            }
        }

        // --- 2. SWIPE LOGIC (Unchanged) ---
        function swipeCard(card, direction) { 
            card.classList.add(`swipe-${direction}`);
            
            if (direction === 'right') {
                const cardId = card.dataset.id;
                const data = (cardId === userCardData.id ? {...userCardData, age: getCardAge(userCardData)} : null);
                
                if (data) {
                    viewerHistory.push(data);
                    viewerHistoryIndex = viewerHistory.length - 1;
                    showMediaViewer(data);
                }
            }
            setTimeout(() => {
                card.remove();
                loadNextCard(); 
            }, 300);
        }
        
        function addSwipeListeners(card) { /* ... same drag/touch logic ... */
            let startX, isDragging = false;
            
            function handleStart(e) { e.preventDefault(); isDragging = true; startX = e.clientX || e.touches[0].clientX; card.style.transition = 'none'; }
            function handleMove(e) { if (!isDragging) return; const currentX = e.clientX || e.touches[0].clientX; const deltaX = currentX - startX; const rotate = deltaX / 20; card.style.transform = `translateX(${deltaX}px) rotate(${rotate}deg)`; }
            function handleEnd(e) {
                if (!isDragging) return; isDragging = false; card.style.transition = 'transform 0.3s ease-out, opacity 0.3s ease-out';
                const finalX = e.clientX || e.changedTouches[0].clientX; const deltaX = finalX - startX; const threshold = 100;
                if (deltaX > threshold) { swipeCard(card, 'right'); } else if (deltaX < -threshold) { swipeCard(card, 'left'); } else { card.style.transform = 'translate(0) rotate(0)'; }
            }
            card.addEventListener('mousedown', handleStart); card.addEventListener('touchstart', handleStart);
            document.addEventListener('mousemove', handleMove); document.addEventListener('touchmove', handleMove);
            document.addEventListener('mouseup', handleEnd); document.addEventListener('touchend', handleEnd);
            card.addEventListener('remove', () => { /* Cleanup listeners */});
        }


        // --- 3. PROFILE CONSOLE LOGIC (NEW) ---
        
        function generateNewMedia() {
            const prompt = document.getElementById('mediaPrompt').value.trim();
            if (prompt.length < 10) {
                alert("Prompt too short. Provide a detailed prompt (min 10 chars) for the Media Engine.");
                return;
            }

            // Mock Image Generation Process
            const newImage = `https://picsum.photos/320/280?seed=${Date.now()}`;
            userCardData.imageUrl = newImage;
            
            // Save prompt as new card description
            userCardData.description = `Generated by prompt: "${prompt.substring(0, 40)}..."`;

            localStorage.setItem('userCard', JSON.stringify(userCardData));
            
            alert(`[AI Engine] Media generated for prompt: "${prompt}"! Card image and description updated.`);
            window.location.reload(); // Reload to show new user card immediately
        }

        function renderProfileConsole() {
            const data = userCardData;
            const ageDisplay = getCardAge(data);
            
            // Generate the list of matching users HTML
            const matchHtml = MOCK_ENGAGEMENTS.map(match => `
                <div class="match-item">
                    <span>${match.user} (${match.media})</span>
                    <span class="match-percent">${match.match}% Match</span>
                </div>
            `).join('');

            profileConsole.innerHTML = `
                <div class="console-title">üéØ USER PROFILE CONSOLE: ${data.user.toUpperCase()}</div>

                <div class="match-list-title">MY CURRENT TOP CARD: ${data.title.toUpperCase()}</div>
                <div class="my-card-static">
                    <img src="${data.imageUrl}" alt="User Media">
                    <div class="my-card-info">
                        <strong>User Handle:</strong> ${data.user}<br>
                        <strong>Age:</strong> ${ageDisplay}<br>
                        <strong>Project:</strong> ${data.title}<br>
                        <hr style="border-color: rgba(0, 255, 102, 0.3);">
                        <strong>Bio:</strong> ${data.bio || 'No bio set. Customize!'}
                    </div>
                </div>

                <div class="match-list-title">LATEST 3 ENGAGEMENTS (MATCH RATING)</div>
                <div class="match-list">
                    ${matchHtml}
                </div>

                <div class="bio-area">
                    <div class="match-list-title">MEDIA GENERATION ENGINE (AI PROMPT)</div>
                    <label for="mediaPrompt" style="color: var(--neon-green); font-size: 0.9em;">Prompt to generate new card image:</label>
                    <textarea id="mediaPrompt" placeholder="Example: A dark, rainy cyberpunk street corner with a glowing neon sign of a dragon..."></textarea>
                    <button class="ui-button generate-btn" onclick="generateNewMedia()">üé® GENERATE NEW MEDIA</button>
                </div>
            `;
        }


        // --- 4. MODAL & AUTH LOGIC (Updated to save bio) ---

        function updateLoginState(handle, isLoggedIn) { /* ... same login state logic ... */
            isUserLoggedIn = isLoggedIn;
            localStorage.setItem('isLoggedIn', isLoggedIn);
            localStorage.setItem('userHandle', handle);
            document.getElementById('loginBtn').textContent = isLoggedIn ? `üîí LOGOUT (${handle})` : 'üîì LOGIN/LOGOUT';
            document.getElementById('loggedInUser').textContent = handle;
            document.getElementById('logoutSection').style.display = isLoggedIn ? 'block' : 'none';
            document.getElementById('loginForm').style.display = isLoggedIn ? 'none' : 'block';
            document.getElementById('loginTitle').textContent = isLoggedIn ? 'System Status' : 'System Login';
        }
        
        document.getElementById('customizeBtn').addEventListener('click', () => {
            if (!isUserLoggedIn) {
                alert('ACCESS DENIED. Please log in to customize your card.');
                return;
            }
            // Populate form fields
            document.getElementById('cardBirthday').value = userCardData.birthday || '';
            document.getElementById('cardTitle').value = userCardData.title;
            document.getElementById('cardDesc').value = userCardData.description;
            document.getElementById('cardMedia').value = userCardData.imageUrl;
            document.getElementById('customizeModal').style.display = 'flex';
        });

        document.getElementById('cardCustomizationForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const birthdayInput = document.getElementById('cardBirthday').value;
            const calculatedAge = calculateAge(birthdayInput);
            if (calculatedAge === 'N/A') {
                alert('ERROR: Invalid or future birth date. Please check your entry.');
                return;
            }

            userCardData.birthday = birthdayInput;
            userCardData.title = document.getElementById('cardTitle').value;
            userCardData.description = document.getElementById('cardDesc').value;
            userCardData.imageUrl = document.getElementById('cardMedia').value;
            userCardData.user = localStorage.getItem('userHandle');
            // NOTE: The Bio field is now edited/set in the Profile Console, not here.

            localStorage.setItem('userCard', JSON.stringify(userCardData));
            console.log(`[API Mock] User Card Saved to Server (Age: ${calculatedAge}):`, userCardData);
            
            alert(`Card data successfully saved and updated! Your age is now: ${calculatedAge}`);
            closeCustomizeModal();
            window.location.reload(); 
        });

        // --- VIEWER LOGIC (Simplified function calls) ---
        function showMediaViewer(data) { /* ... */ }
        function closeMediaViewer() { /* ... */ }
        function renderMedia(data) { /* ... */ }
        function updateNavButtons() { /* ... */ }
        document.getElementById('prevMediaBtn').addEventListener('click', () => { /* ... */ });
        document.getElementById('nextMediaBtn').addEventListener('click', () => { /* ... */ });
        
        // --- UTILITY LOGIC ---
        document.getElementById('loginForm').addEventListener('submit', function(e) { /* ... */ });
        document.getElementById('loginBtn').addEventListener('click', () => { /* ... */ });
        function closeLoginModal() { document.getElementById('loginModal').style.display = 'none'; }
        function logout() { /* ... */ }
        function closeCustomizeModal() { document.getElementById('customizeModal').style.display = 'none'; }
        document.getElementById('dislikeBtn').addEventListener('click', () => { const topCard = swipeContainer.querySelector('.card:last-child'); if (topCard) swipeCard(topCard, 'left'); });
        document.getElementById('likeBtn').addEventListener('click', () => { const topCard = swipeContainer.querySelector('.card:last-child'); if (topCard) swipeCard(topCard, 'right'); });
        
        // --- INITIALIZATION ---
        function init() {
            const handle = localStorage.getItem('userHandle') || '@Guest';
            const loggedIn = localStorage.getItem('isLoggedIn') === 'true';
            updateLoginState(handle, loggedIn);
            loadNextCard();
            renderProfileConsole(); // RENDER THE NEW CONSOLE
        }
        
        init();

    </script>
</body>
</html>
