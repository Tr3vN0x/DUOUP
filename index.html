<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DUO UP Profiles & Friends</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
/* --- BASE STYLES --- */
body { 
    margin:0; 
    font-family:'Orbitron',sans-serif; 
    background:#0b0b0b; 
    color:white; 
}
.container { width:90%; max-width: 1000px; margin:auto; padding:20px; }
.hidden { display:none; }

/* --- HEADER & ICON STYLES --- */
.header {
    background: #111;
    border-bottom: 3px solid cyan;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
    padding: 10px 0;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.header h1 {
    font-size: 2.5em;
    color: #fff;
    text-shadow: 0 0 5px cyan, 0 0 10px cyan, 0 0 15px magenta;
    margin: 0;
}
.icon-container {
    margin-right: 15px;
    font-size: 2.5em;
    color: cyan;
    text-shadow: 0 0 5px cyan, 0 0 10px magenta;
}

/* --- BUTTON STYLES --- */
.neon-btn { 
    border:2px solid cyan; 
    background:transparent; 
    color:white; 
    padding:8px 14px; 
    margin:5px; 
    border-radius:6px; 
    cursor:pointer; 
    box-shadow:0 0 10px cyan; 
    transition: all 0.2s ease-in-out;
    text-transform: uppercase;
    font-family: 'Orbitron', sans-serif; 
}
.neon-btn:hover { border-color:magenta; box-shadow:0 0 15px magenta; }
.neon-btn.remove { border-color: red; box-shadow: 0 0 10px red; }
.neon-btn.remove:hover { border-color: orange; box-shadow: 0 0 15px orange; }

/* --- FILTER STYLES (UPDATED) --- */
.filter-box {
    margin-bottom: 20px;
    padding: 15px;
    border: 1px solid magenta;
    border-radius: 8px;
    background: #181818;
    display: grid;
    grid-template-columns: auto 1fr 1fr auto auto; /* Label | Game Select | Category Select | Filter Button | Clear Button */
    gap: 10px;
    align-items: center;
}
.filter-box label {
    font-weight: bold;
    color: cyan;
    white-space: nowrap;
}
.filter-box select {
    padding: 8px;
    border: 1px solid #444;
    background: #222;
    color: white;
    border-radius: 4px;
    font-family: inherit;
    outline: none;
    min-height: 40px;
}
#gameCategoryFilterContainer {
    display: flex;
    gap: 5px;
}
#gameCategoryFilterContainer label {
    color: magenta;
}
.filter-box .neon-btn {
    margin: 0;
    padding: 8px 12px;
}

/* --- CARD/LAYOUT STYLES --- */
.flex { display:flex; gap:15px; flex-wrap:wrap; }
.card-container {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
}
.card { 
    width:250px; 
    padding:15px; 
    border:2px solid cyan; 
    border-radius:12px; 
    background:#111; 
    box-shadow:0 0 10px cyan; 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    margin-bottom: 15px;
    cursor: pointer; 
}
.card-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    margin-bottom: 10px; /* Space before buttons */
}
.avatar { width:50px; height:50px; border-radius:50%; border:2px solid cyan; object-fit:cover; margin-bottom:10px; }

/* --- LED OWNER BADGE STYLES --- */
.owner-badge-box {
    display: inline-block;
    padding: 2px 6px;
    margin-left: 8px;
    font-size: 0.7em; 
    font-weight: bold;
    letter-spacing: 1px;
    border-radius: 4px;
    text-transform: uppercase;
    
    background: #3a005c; 
    color: #ffccff; 
    border: 1px solid #ff00ff; 
    box-shadow: 
        0 0 5px #ff00ff,   
        0 0 10px #cc33ff,  
        inset 0 0 5px #ff00ff; 
    vertical-align: middle;
}

/* --- RATING AND STATUS STYLES --- */
.skill-rating {
    color: gold; /* Classic star color */
    font-size: 1.2em;
    margin-bottom: 5px;
}
.status-indicator {
    font-size: 0.8em;
    padding: 3px 8px;
    border-radius: 4px;
    font-weight: bold;
    margin-bottom: 10px;
}
.status-online { background-color: #00cc00; color: #0b0b0b; box-shadow: 0 0 5px #00ff00; }
.status-ingame { background-color: #ffaa00; color: #0b0b0b; box-shadow: 0 0 5px #ffaa00; }
.status-lfd { background-color: #00aaff; color: #0b0b0b; box-shadow: 0 0 5px #00aaff; }

/* --- MESSAGE STYLES --- */
.message-container { 
    background: #181818; 
    border-radius: 8px; 
    padding: 15px; 
    margin-top: 15px; 
    border: 1px solid #333;
}
.message-item {
    border-bottom: 1px dashed #444;
    padding: 10px 0;
}
.message-item:last-child { border-bottom: none; }
.message-header { font-size: 0.9em; color: cyan; margin-bottom: 5px; }
.message-body { font-size: 1em; }
.message-unread { background-color: #2a0038; border-left: 5px solid magenta; padding-left: 10px; }

/* --- UNREAD COUNT BADGE --- */
.unread-badge {
    background-color: magenta;
    color: white;
    border-radius: 50%;
    padding: 2px 7px;
    margin-left: 5px;
    font-size: 0.7em;
    font-weight: bold;
    box-shadow: 0 0 5px magenta;
}

/* --- PROFILE EDITOR STYLES --- */
#profileEditor {
    display: flex;
    flex-direction: column;
    gap: 15px;
    padding: 20px;
    border: 2px solid magenta;
    border-radius: 12px;
    background: #111;
    box-shadow: 0 0 15px magenta;
    max-width: 500px;
    margin: 20px auto;
}
#profileEditor label {
    font-weight: bold;
    color: cyan;
}
#profileEditor input, #profileEditor textarea, #profileEditor select {
    padding: 10px;
    border: 1px solid #333;
    background: #222;
    color: white;
    border-radius: 6px;
    font-family: inherit;
    outline: none;
    min-height: 40px; /* Ensure selects are visible */
}
#currentAvatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 3px solid cyan;
    align-self: center;
    object-fit: cover;
    margin-bottom: 15px;
}
#gamesInput {
    /* For the select multiple field */
    height: 100px; 
}
.game-tag {
    display: inline-block;
    background: #222;
    border: 1px solid #444;
    padding: 5px 10px;
    margin-right: 8px;
    margin-bottom: 8px;
    border-radius: 4px;
    font-size: 0.9em;
}
</style>
</head>
<body>

<div class="header">
    <div class="icon-container">
        ⚡
    </div>
    <h1>DUO UP</h1>
</div>

<div id="loginPage" class="container">
  <p>Find your perfect partner and dominate the cyber-arena.</p>
  <button class="neon-btn" onclick="login()">Login with Google</button>
</div>

<div id="dashboard" class="container hidden">
  <h2 id="welcome"></h2>
  <div style="margin-bottom: 20px;">
    <button class="neon-btn" onclick="showTab('suggested')">Suggested</button>
    <button class="neon-btn" onclick="showTab('requests')">Requests</button>
    <button id="friendsBtn" class="neon-btn" onclick="showTab('friends')">
        Friends <span id="unreadBadge" class="unread-badge hidden">0</span>
    </button>
    <button class="neon-btn" onclick="showTab('profile')">Profile</button>
    <button class="neon-btn" onclick="logout()">Logout</button>
  </div>

  <div id="suggestedTab">
    <div class="filter-box">
        <label for="gameFilterInput">Game:</label>
        <select id="gameFilterInput" onchange="updateCategoryFilter()">
            </select>

        <div id="gameCategoryFilterContainer">
            <label for="categoryFilterInput" id="categoryLabel">Category:</label>
            <select id="categoryFilterInput" disabled>
                <option value="">-- Select Game First --</option>
            </select>
        </div>
        
        <button class="neon-btn" onclick="loadSuggested()">Filter</button>
        <button class="neon-btn remove" onclick="clearFilter()">Clear</button>
    </div>
    <div id="suggestedCards" class="card-container">
        </div>
  </div>
  <div id="requestsTab" class="flex hidden"></div>
  <div id="friendsTab" class="flex hidden"></div>
  <div id="profileTab" class="hidden">
    <div id="profileEditor">
        <img id="currentAvatar" src="" alt="Current Profile Picture">
        
        <p><b>Nickname:</b> <span id="currentNicknameDisplay"></span></p>

        <label for="bioInput">Bio:</label>
        <textarea id="bioInput" rows="3" maxlength="150" placeholder="Tell the community about yourself..."></textarea>
        
        <label for="gamesInput">Favorite Games (Hold CTRL/CMD to select multiple):</label>
        <select id="gamesInput" multiple size="4">
             </select>
        
        <label for="skillRatingInput">Skill Rating (1-5 Stars):</label>
        <select id="skillRatingInput">
            <option value="1">⭐ 1 Star (Casual)</option>
            <option value="2">⭐⭐ 2 Stars (Intermediate)</option>
            <option value="3">⭐⭐⭐ 3 Stars (Competent)</option>
            <option value="4">⭐⭐⭐⭐ 4 Stars (Advanced)</option>
            <option value="5">⭐⭐⭐⭐⭐ 5 Stars (Expert)</option>
        </select>

        <label for="statusInput">Current Status:</label>
        <select id="statusInput">
            <option value="Online">Online</option>
            <option value="Looking for Duo">Looking for Duo</option>
            <option value="In Game">In Game</option>
            <option value="Away">Away</option>
        </select>
        
        <label for="avatarUrlInput">Profile Picture URL:</label>
        <input type="url" id="avatarUrlInput" placeholder="https://example.com/image.jpg" oninput="document.getElementById('currentAvatar').src = this.value || DEFAULT_AVATAR">

        <button class="neon-btn" onclick="saveProfile()">Save Profile</button>
    </div>
  </div>

  <div id="profileViewer" class="hidden">
    </div>
</div>


<script>
// -------------------- GAME CONFIGURATION DATA --------------------
// The list of games and their potential categories for filtering.
const GAME_CONFIG = {
    // === EXAMPLE 1: FPS Game ===
    "Valorant": {
        categories: ["Role", "Rank"],
        Role: ["Duelist", "Controller", "Sentinel", "Initiator"],
        Rank: ["Bronze", "Silver", "Gold", "Platinum", "Diamond", "Ascendant", "Immortal", "Radiant"]
    },
    // === EXAMPLE 2: MOBA Game ===
    "League of Legends": {
        categories: ["Lane", "Rank"],
        Lane: ["Top", "Jungle", "Mid", "Bot/ADC", "Support"],
        Rank: ["Iron", "Bronze", "Silver", "Gold", "Platinum", "Emerald", "Diamond", "Master", "Grandmaster", "Challenger"]
    },
    // === EXAMPLE 3: Simple Game ===
    "Minecraft": {
        categories: ["Mode"],
        Mode: ["Survival", "Creative", "Hardcore"]
    },
    // Add more games here (up to 200)
    "Apex Legends": {},
    "Rocket League": {},
    "Overwatch 2": {},
    "Fortnite": {},
    "Genshin Impact": {},
    "World of Warcraft": {},
    "Dota 2": {}
};

// --- FIREBASE CONFIGURATION (UPDATE THIS BLOCK) ---
const firebaseConfig = {
  apiKey:"AIzaSyDVHxatohLvJNqIHXjf1ZXdmmWX5W1EpNw",
  authDomain:"duoup-cfae6.firebaseapp.com",
  projectId:"duoup-cfae6",
  storageBucket:"duoup-cfae6.firebasestorage.app",
  messagingSenderId:"812263060524",
  appId:"1:812263060524:web:ac09c3ae610db1cd110d89"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const DEFAULT_AVATAR = "https://cdn-icons-png.flaticon.com/512/149/149071.png";

// --- OWNER UID CONSTANT (CRITICAL: YOUR OWNER ID) ---
const OWNER_UID = "DecuxiBRxoSwb8wKMmaHQKql9HQ2"; 

let currentUser = null;
let unreadMessageCount = 0; 

// Helper functions (Unchanged)
function getOwnerBadge(uid) {
    if (uid === OWNER_UID) {
        return '<span class="owner-badge-box" title="App Owner">OWNER</span>';
    }
    return '';
}
function renderSkillRating(rating) {
    rating = parseInt(rating) || 0;
    const filledStars = '⭐'.repeat(rating);
    const emptyStars = '☆'.repeat(5 - rating);
    return `<div class="skill-rating" title="Skill Rating: ${rating}/5">${filledStars}${emptyStars}</div>`;
}
function renderStatus(status) {
    let statusClass = '';
    let displayStatus = status || 'Away';
    
    if (displayStatus === 'Online') {
        statusClass = 'status-online';
    } else if (displayStatus === 'In Game') {
        statusClass = 'status-ingame';
    } else if (displayStatus === 'Looking for Duo') {
        statusClass = 'status-lfd';
    } else {
        statusClass = '';
    }
    return `<div class="status-indicator ${statusClass}">${displayStatus}</div>`;
}

// ---------------- DROPDOWN POPULATION FUNCTIONS ----------------
function populateGamesDropdown() {
    const select = document.getElementById('gamesInput');
    select.innerHTML = '';
    
    Object.keys(GAME_CONFIG).sort().forEach(game => {
        const option = document.createElement('option');
        option.value = game;
        option.textContent = game;
        select.appendChild(option);
    });
}

function populateGameFilterDropdown() {
    const select = document.getElementById('gameFilterInput');
    select.innerHTML = '';
    
    const allOption = document.createElement('option');
    allOption.value = '';
    allOption.textContent = '--- All Games ---';
    select.appendChild(allOption);

    Object.keys(GAME_CONFIG).sort().forEach(game => {
        const option = document.createElement('option');
        option.value = game;
        option.textContent = game;
        select.appendChild(option);
    });
}

/**
 * Updates the second filter dropdown (Category/Role) based on the game selected.
 */
function updateCategoryFilter() {
    const gameSelect = document.getElementById('gameFilterInput');
    const categorySelect = document.getElementById('categoryFilterInput');
    const categoryLabel = document.getElementById('categoryLabel');
    const selectedGame = gameSelect.value;

    categorySelect.innerHTML = ''; // Clear previous options
    categorySelect.disabled = true;

    if (!selectedGame) {
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = '-- Select Game First --';
        categorySelect.appendChild(defaultOption);
        categoryLabel.textContent = 'Category:';
        return;
    }

    const config = GAME_CONFIG[selectedGame];

    if (!config || !config.categories || config.categories.length === 0) {
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = 'No Categories for this Game';
        categorySelect.appendChild(defaultOption);
        categoryLabel.textContent = 'Category:';
        return;
    }
    
    // For simplicity, we will only use the FIRST category for filtering
    const categoryName = config.categories[0]; 
    categoryLabel.textContent = `${categoryName}:`;
    categorySelect.disabled = false;

    const allOption = document.createElement('option');
    allOption.value = '';
    allOption.textContent = `--- Any ${categoryName} ---`;
    categorySelect.appendChild(allOption);

    const categoryValues = config[categoryName];
    if (categoryValues && Array.isArray(categoryValues)) {
        categoryValues.forEach(value => {
            const option = document.createElement('option');
            option.value = `${categoryName}:${value}`; // Format: "Role:Controller"
            option.textContent = value;
            categorySelect.appendChild(option);
        });
    }
}

// ---------------- LOGIN/AUTH ----------------
function login(){
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).catch(err => alert(err.message));
}

auth.onAuthStateChanged(async user=>{
  if(!user){
    loginPage.classList.remove("hidden");
    dashboard.classList.add("hidden");
    return;
  }
  loginPage.classList.add("hidden");
  dashboard.classList.remove("hidden");
  currentUser = user;

  // Populate dropdowns immediately after auth
  populateGamesDropdown();
  populateGameFilterDropdown();
  updateCategoryFilter(); // Initialize category filter

  const userDocRef = db.collection("users").doc(user.uid);
  const userDoc = await userDocRef.get();
  
  if(!userDoc.exists){
    await userDocRef.set({
      uid: user.uid,
      nickname: user.displayName||"Player", 
      bio: "", 
      games: [], 
      gameDetails: {}, // New field to store category/role data
      friends: [],
      nicknames: {}, 
      profileImageUrl: user.photoURL||DEFAULT_AVATAR,
      skillRating: 3, 
      status: "Online"
    });
  }

  const data = (await userDocRef.get()).data();
  document.getElementById("welcome").innerHTML = `Welcome, ${data.nickname}${getOwnerBadge(data.uid)}`;

  loadUnreadCount(); 
  loadSuggested();
  loadRequests();
  loadFriends();
  loadProfileEditor(data); 
});

function logout(){ 
    auth.signOut(); 
}

function hideAllTabs() {
    document.getElementById("suggestedTab").classList.add("hidden");
    document.getElementById("requestsTab").classList.add("hidden");
    document.getElementById("friendsTab").classList.add("hidden");
    document.getElementById("profileTab").classList.add("hidden");
    document.getElementById("profileViewer").classList.add("hidden");
}

function showTab(tab){
  hideAllTabs();

  const tabElement = document.getElementById(tab+"Tab");
  if (tabElement) {
    tabElement.classList.remove("hidden");
  }

  if (tab === 'profile') {
      db.collection("users").doc(currentUser.uid).get().then(doc => {
          loadProfileEditor(doc.data());
      });
  } else if (tab === 'suggested') {
      loadSuggested();
  } else if (tab === 'requests') {
      loadRequests();
  } else if (tab === 'friends') {
      loadFriends();
  }
}

// --- Message Functions (Omitted for brevity, but they are in the full HTML) ---
// --- Profile Viewer Logic (Omitted for brevity, but it is in the full HTML) ---

// ---------------- PROFILE EDITOR FUNCTIONS (MINOR UPDATE FOR FUTURE) ----------------
function loadProfileEditor(data){
    data = data || {};
    
    currentNicknameDisplay.innerHTML = `${data.nickname || "Player"}${getOwnerBadge(currentUser.uid)}`;
    
    bioInput.value = data.bio || "";
    
    const gamesSelect = document.getElementById('gamesInput');
    const savedGames = data.games || [];

    populateGamesDropdown(); 
    
    Array.from(gamesSelect.options).forEach(option => {
        option.selected = savedGames.includes(option.value);
    });

    avatarUrlInput.value = data.profileImageUrl || currentUser.photoURL || "";
    currentAvatar.src = data.profileImageUrl || currentUser.photoURL || DEFAULT_AVATAR;

    skillRatingInput.value = data.skillRating || "3";
    statusInput.value = data.status || "Online";
    
    // NOTE: gameDetails editor is not yet implemented here, we only save the games array for now.
}

async function saveProfile(){
    if (!currentUser) return;
    
    const currentData = (await db.collection("users").doc(currentUser.uid).get()).data();
    const currentNickname = currentData.nickname;

    const gamesSelect = document.getElementById('gamesInput');
    const selectedGames = Array.from(gamesSelect.selectedOptions).map(option => option.value).filter(game => game !== '');
    
    const profileUpdates = {
        bio: bioInput.value.trim(),
        games: selectedGames, 
        profileImageUrl: avatarUrlInput.value.trim() || DEFAULT_AVATAR,
        skillRating: parseInt(skillRatingInput.value),
        status: statusInput.value
    };

    try {
        await db.collection("users").doc(currentUser.uid).update(profileUpdates);
        alert("Profile updated successfully!");
        
        document.getElementById("welcome").innerHTML = `Welcome, ${currentNickname}${getOwnerBadge(currentUser.uid)}`;
        
        loadSuggested();
        loadFriends();
    } catch(error) {
        alert("Error saving profile.");
        console.error("Profile Save Error:", error);
    }
}

// ---------------- LOAD FUNCTIONS (UPDATED FOR CATEGORY FILTERING) ----------------

function clearFilter() {
    document.getElementById('gameFilterInput').value = '';
    document.getElementById('categoryFilterInput').value = '';
    updateCategoryFilter(); // Resets the category dropdown
    loadSuggested();
}


async function loadSuggested(){
  const suggestedCards = document.getElementById("suggestedCards");
  suggestedCards.innerHTML="<p>Loading suggested users...</p>";
  
  try {
      // 1. Get Filter Values
      const filterGame = document.getElementById('gameFilterInput').value.trim();
      const filterCategoryValue = document.getElementById('categoryFilterInput').value.trim(); // e.g., "Role:Controller"

      let usersQuery = db.collection("users");
      let filterMessage = "Loading all suggested users...";
      let hasFilter = false;

      // 2. Apply Game Filter
      if (filterGame) {
          usersQuery = usersQuery.where("games", "array-contains", filterGame);
          filterMessage = `Filtering users who play: <b>${filterGame}</b>...`;
          hasFilter = true;
      }
      
      // NOTE: Filtering by Category/Role requires a dedicated field (gameDetails) 
      // or using two array-contains clauses, which is not possible in a single Firestore query.
      // For now, we only filter by the main game. If you wish to filter by category, 
      // we must implement the saving of category details in the Profile Editor first.
      
      if(filterGame && filterCategoryValue) {
          // *** TEMPORARY NOTE: CATEGORY FILTERING NOT SUPPORTED YET ***
          // The category filter will currently be IGNORED by the Firestore query 
          // because we don't have the user's category details (e.g., 'Valorant Role') saved 
          // in a queryable field yet.
          // We will proceed with only the Game filter for now.
          filterMessage += `<span style="color:yellow; font-size: 0.9em;"> (Category filter will be implemented in the next step!)</span>`;
      }
      
      suggestedCards.innerHTML = `<p>${filterMessage}</p>`;


      const usersSnap = await usersQuery.get(); 
      const me = (await db.collection("users").doc(currentUser.uid).get()).data();
      suggestedCards.innerHTML = ""; 

      const myFriends = me.friends || [];
      const mySentRequestsSnap = await db.collection("friendRequests").where("senderId", "==", currentUser.uid).get();
      const myReceivedRequestsSnap = await db.collection("friendRequests").where("receiverId", "==", currentUser.uid).get();

      const pendingUsers = new Set();
      mySentRequestsSnap.forEach(doc => pendingUsers.add(doc.data().receiverId));
      myReceivedRequestsSnap.forEach(doc => pendingUsers.add(doc.data().senderId));

      let suggestedCount = 0;
      usersSnap.forEach(doc=>{
        if(doc.id === currentUser.uid) return; 
        if(myFriends.includes(doc.id)) return; 
        if(pendingUsers.has(doc.id)) return; 
        
        const u = doc.data();
        const card = document.createElement("div");
        card.className = "card";
        card.setAttribute('onclick', `viewProfile('${doc.id}')`);
        
        const badgeHtml = getOwnerBadge(u.uid);
        const gamesPreview = (u.games && u.games.length > 0) ? `<p style="font-size:0.8em; margin: 5px 0;">Games: ${u.games.slice(0, 2).join(', ')}...</p>` : '';
        const ratingHtml = renderSkillRating(u.skillRating);
        const statusHtml = renderStatus(u.status);


        card.innerHTML = `
            <div class="card-content">
                <img class="avatar" src="${u.profileImageUrl||DEFAULT_AVATAR}">
                <strong>${u.nickname}${badgeHtml}</strong>
                ${ratingHtml}
                ${statusHtml}
                ${gamesPreview}
            </div>
            <button class="neon-btn" onclick="event.stopPropagation(); sendRequest('${doc.id}')">View & Send Request</button>
        `;
        suggestedCards.appendChild(card);
        suggestedCount++;
      });

      if (suggestedCount === 0) {
          suggestedCards.innerHTML=`<p>No suggested players available right now${filterGame ? ` who play <b>${filterGame}</b>` : ''}.</p>`;
      }
  } catch(error) {
      suggestedCards.innerHTML = `<p style="color:red;">Error loading suggested users: ${error.message}</p>`;
      console.error("Suggested Load Error:", error);
  }
}

// --- Requests & Friends Load/Action Functions (Omitted for brevity, but they are in the full HTML) ---

</script>
</body>
</html>
