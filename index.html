<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DUO UP Profiles & Friends (Client-Only)</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
<style>
/* --- BASE STYLES --- */
body { margin:0; font-family:'Orbitron',sans-serif; background:#0b0b0b; color:white; }
.container { width:90%; max-width:1000px; margin:auto; padding:20px; }
.hidden { display:none !important; }
.header { background:#111; border-bottom:3px solid cyan; box-shadow:0 0 20px rgba(0,255,255,0.5); padding:10px 0; margin-bottom:20px; display:flex; align-items:center; justify-content:center; }
.header h1 { font-size:2.5em; color:#fff; text-shadow:0 0 5px cyan,0 0 10px cyan,0 0 15px magenta; margin:0; }
.icon-container { margin-right:15px; font-size:2.5em; color:cyan; text-shadow:0 0 5px cyan,0 0 10px magenta; }
.neon-btn { border:2px solid cyan; background:transparent; color:white; padding:8px 14px; margin:5px; border-radius:6px; cursor:pointer; box-shadow:0 0 10px cyan; transition:all 0.2s ease-in-out; text-transform:uppercase; font-family:'Orbitron',sans-serif; white-space: nowrap; }
.neon-btn:hover { border-color:magenta; box-shadow:0 0 15px magenta; }
.neon-btn:disabled { border-color: #555; box-shadow: none; color: #555; cursor: not-allowed; }
.neon-btn.remove { border-color:red; box-shadow:0 0 10px red; }
.neon-btn.remove:hover { border-color:orange; box-shadow:0 0 15px orange; }
#messageInput, #profileBio, #profileSkillRating, #profileStatus, #searchInput, #statusFilter, #skillFilter, #profileNickname, #newUsernameInput { flex-grow:1; padding:10px; border:1px solid cyan; background:#181818; color:white; border-radius:6px; font-family:inherit; outline:none; }
#messageInput:focus, #profileBio:focus, #profileSkillRating:focus, #profileStatus:focus, #newUsernameInput:focus { border-color: magenta; box-shadow: 0 0 8px magenta; }
#profileBio { resize: vertical; }
#profileSkillRating, #profileStatus { width: 100%; max-width: 200px; }
.flex { display:flex; gap:15px; flex-wrap:wrap; justify-content:center; }
.card-container { display:flex; flex-wrap:wrap; gap:15px; justify-content:center; }

/* --- USER CARD --- */
.card { 
    width: 100%; 
    max-width:300px; 
    padding:15px; 
    border:2px solid cyan; 
    border-radius:12px; 
    background:#111; 
    box-shadow:0 0 10px cyan; 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    margin-bottom:15px; 
    cursor:pointer; 
    overflow: hidden; 
}
.card-content { display:flex; flex-direction:column; align-items:center; width:100%; margin-bottom:10px; }
.avatar { width:50px; height:50px; border-radius:50%; border:2px solid cyan; object-fit:cover; margin-bottom:10px; }
.card-gamer-preview {
    width: 100%;
    height: 100px; 
    object-fit: cover;
    margin-top: 10px;
    border-radius: 6px;
    border: 1px solid magenta;
    box-shadow: inset 0 0 5px magenta;
}
.owner-badge-box { display:inline-block; padding:2px 6px; margin-left:8px; font-size:0.7em; font-weight:bold; letter-spacing:1px; border-radius:4px; text-transform:uppercase; background:#3a005c; color:#ffccff; border:1px solid #ff00ff; box-shadow:0 0 5px #ff00ff,0 0 10px #cc33ff, inset 0 0 5px #ff00ff; vertical-align:middle; }
.skill-rating { color:gold; font-size:1.2em; margin-bottom:5px; }
.status-indicator { font-size:0.8em; padding:3px 8px; border-radius:4px; font-weight:bold; margin-bottom:10px; }
.status-online { background-color:#00cc00; color:#0b0b0b; box-shadow:0 0 5px #00ff00; }
.status-ingame { background-color:#ffaa00; color:#0b0b0b; box-shadow:0 0 5px #ffaa00; }
.status-lfd { background-color:#00aaff; color:#0b0b0b; box-shadow:0 0 5px #00aaff; }
.unread-badge { background-color:magenta; color:white; border-radius:50%; padding:2px 7px; margin-left:5px; font-size:0.7em; font-weight:bold; box-shadow:0 0 5px magenta; }
#messagingTab { display: grid; grid-template-columns: 1fr 2fr; height: 600px; border: 2px solid magenta; border-radius: 12px; background: #111; }
#chatList { padding:10px; border-right:1px solid #333; overflow-y:auto; }
#chatWindow { display:flex; flex-direction:column; padding:10px; }

/* --- CHAT BUBBLE STYLES --- */
#messageDisplay { 
    flex-grow: 1; 
    overflow-y: auto; 
    padding: 15px; 
    background: #0b0b0b; 
    border-radius: 6px; 
    margin-bottom: 10px; 
    display: flex; 
    flex-direction: column; 
    gap: 10px; 
}
.message-wrapper { 
    display: flex; 
    width: 100%; 
}
.message-mine { 
    justify-content: flex-end; 
}
.message-other { 
    justify-content: flex-start; 
}
.message-bubble { 
    display: inline-block; 
    padding: 10px 15px; 
    border-radius: 20px; 
    max-width: 65%; 
    font-family: Arial, sans-serif; 
    word-wrap: break-word; 
    font-size: 1.0em; 
    line-height: 1.4; 
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}
.message-mine .message-bubble { 
    background: magenta; 
    color: white; 
    border-bottom-right-radius: 4px; 
    box-shadow: 0 0 5px rgba(255, 0, 255, 0.5);
}
.message-other .message-bubble { 
    background: cyan; 
    color: #0b0b0b; 
    border-bottom-left-radius: 4px;
    box-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
}
/* --- END CHAT BUBBLE STYLES --- */

.chat-item-btn { display:block; width:100%; text-align:left; margin-bottom:8px; }
.gamer-card-container { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px; }
.gamer-card { position: relative; width: 150px; height: 150px; border: 2px solid cyan; border-radius: 8px; overflow: hidden; box-shadow: 0 0 10px rgba(0, 255, 255, 0.5); background: #181818; transition: all 0.2s; }
.gamer-card:hover { box-shadow: 0 0 15px magenta; transform: scale(1.02); }
.gamer-card img { width: 100%; height: 100%; object-fit: cover; display: block; }
.gamer-card-slot { width: 150px; height: 150px; border: 2px dashed magenta; border-radius: 8px; display: flex; justify-content: center; align-items: center; position: relative; cursor: pointer; background: #0d0d0d; }
.gamer-card-slot span { font-size: 3em; color: magenta; }
#usernameDisplay { font-size: 1.5em; font-weight: bold; color: yellow; text-shadow: 0 0 5px orange; margin-bottom: 15px; }
#usernameEditor { display: flex; gap: 10px; align-items: center; }

@media (max-width: 600px) { .header h1 { font-size: 1.5em; } .icon-container { font-size: 1.5em; } .dashboard div { display: flex; flex-wrap: wrap; justify-content: center; } .card { max-width: 100%; } #messagingTab { grid-template-columns: 1fr; height: auto; min-height: 400px; } #chatList { border-right: none; border-bottom: 1px solid #333; max-height: 200px; } #profileTab > div > div:nth-child(1) { flex-direction: column; align-items: flex-start; } #profileTab > div > div:nth-child(1) > div { margin-top: 15px; } #profileNickname { width: 100% !important; max-width: 100%; } #profileSkillRating, #profileStatus { max-width: 100%; } #profileBio { width: 100%; } .flex { flex-direction: column; } #searchControls { flex-wrap: wrap; } #searchInput { flex-basis: 100%; } }
</style>
</head>
<body>

<div class="header"><div class="icon-container">⚡</div><h1>DUO UP</h1></div>

<div id="loginPage" class="container">
<p style="text-align:center;">Find your perfect partner and dominate the cyber-arena.</p>
<div style="text-align:center;">
<button class="neon-btn" onclick="login()">Login with Google</button>
</div>
</div>

<div id="dashboard" class="container hidden">
<h2 id="welcome"></h2>
<div style="margin-bottom:20px;">
<button class="neon-btn" onclick="showTab('allUsers')">Suggested</button>
<button class="neon-btn" onclick="showTab('search')">Find Players</button>
<button class="neon-btn" onclick="showTab('requests')">Requests</button>
<button id="friendsBtn" class="neon-btn" onclick="showTab('friends')">Duos</button>
<button class="neon-btn" onclick="showTab('messaging')">Messaging</button>
<button class="neon-btn" onclick="showTab('profile')">Profile</button>
<button class="neon-btn" onclick="logout()">Logout</button>
</div>

<div id="allUsersTab" class="card-container"></div>

<div id="searchTab" class="hidden container">
    <h2>Player Search Filter</h2>
    <div id="searchControls" style="display:flex; gap:15px; margin-bottom:20px; align-items:center;">
        <input type="text" id="searchInput" placeholder="Search by Nickname or Bio..." style="flex-grow:1; padding:10px; border:1px solid magenta; background:#181818; color:white; border-radius:6px;" onkeyup="filterSearchResults()">
        <label style="color:cyan;">Filter Status:</label>
        <select id="statusFilter" style="padding:10px; border:1px solid cyan; background:#181818; color:white; border-radius:6px;" onchange="filterSearchResults()">
            <option value="">Any Status</option>
            <option value="Online">Online</option>
            <option value="In Game">In Game</option>
            <option value="LFD">Looking For Duo (LFD)</option>
        </select>
        <label style="color:cyan;">Min Skill:</label>
        <select id="skillFilter" style="padding:10px; border:1px solid cyan; background:#181818; color:white; border-radius:6px;" onchange="filterSearchResults()">
            <option value="0">Any Skill</option>
            <option value="1">⭐ 1+</option>
            <option value="2">⭐⭐ 2+</option>
            <option value="3">⭐⭐⭐ 3+</option>
            <option value="4">⭐⭐⭐⭐ 4+</option>
            <option value="5">⭐⭐⭐⭐⭐ 5</option>
        </select>
    </div>
    <div id="searchResults" class="card-container"></div>
</div>

<div id="requestsTab" class="flex hidden"></div>
<div id="friendsTab" class="flex hidden"></div>

<div id="messagingTab" class="hidden">
<div id="chatList">
<h3>Active Duos</h3>
<div id="activeDuoList">No Duos to chat with.</div>
</div>

<div id="chatWindow">
<h3 id="chatHeader" style="border-bottom:1px solid cyan; padding-bottom:5px;">Select a Duo</h3>
<div id="messageDisplay"></div>
<div id="messageInputArea" class="hidden" style="display:flex; gap:10px;">
<input type="text" id="messageInput" placeholder="Type your message...">
<button class="neon-btn" id="sendMessageBtn">Send</button>
</div>
</div>
</div>

<div id="viewProfileTab" class="hidden container">
    <button class="neon-btn" onclick="showTab('allUsers')">← Back to Suggested</button>
    <div id="viewProfileContent" style="padding: 20px; border: 2px solid magenta; border-radius: 10px; background: #1a1a1a; margin-top: 20px;">
        </div>
</div>

<div id="profileTab" class="hidden">
    <h2>Cyber-Profile Editor</h2>
    <div style="padding: 20px; border: 2px solid magenta; border-radius: 10px; background: #1a1a1a;">
        <div style="display: flex; align-items: center; margin-bottom: 20px;">
            <img id="profileAvatar" class="avatar" style="width: 80px; height: 80px; margin-right: 20px; border-color: magenta;" src="">
            <div>
                <label style="color: cyan; display: block; margin-bottom: 5px;">Unique Identifier:</label>
                <input type="text" id="profileNickname" value="User Nickname" disabled>
            </div>
        </div>
        <div style="margin-bottom: 15px;">
            <label style="color: cyan; display: block; margin-bottom: 5px;">Upload Avatar:</label>
            <input type="file" id="avatarUpload" accept="image/*" onchange="previewAvatar(this)">
        </div>

        <h3 style="color:cyan; margin-top: 25px;">Unique Username (@)</h3>
        <p id="usernameDisplay">@Loading...</p>
        <div id="usernameEditor" style="margin-bottom: 20px;">
            <input type="text" id="newUsernameInput" placeholder="Enter new username (a-z, 0-9, 3-20 chars)" style="flex-grow: 1;">
            <button class="neon-btn" id="changeUsernameBtn" onclick="attemptUsernameChange()">Set/Change Username</button>
        </div>
        <p id="usernameMessage" style="color: yellow;"></p>
        
        <div style="margin-bottom: 15px;">
            <label style="color: cyan; display: block; margin-bottom: 5px;">Bio/Tagline:</label>
            <textarea id="profileBio" rows="3" style="width: 100%;"></textarea>
        </div>
        <div style="display: flex; gap: 30px; margin-bottom: 20px;">
            <div>
                <label style="color: cyan; display: block; margin-bottom: 5px;">Skill Rating (1-5):</label>
                <select id="profileSkillRating">
                    <option value="1">⭐</option>
                    <option value="2">⭐⭐</option>
                    <option value="3">⭐⭐⭐</option>
                    <option value="4">⭐⭐⭐⭐</option>
                    <option value="5">⭐⭐⭐⭐⭐</option>
                </select>
            </div>
            <div>
                <label style="color: cyan; display: block; margin-bottom: 5px;">Current Status:</label>
                <select id="profileStatus">
                    <option value="Online">Online</option>
                    <option value="In Game">In Game</option>
                    <option value="LFD">Looking For Duo (LFD)</option>
                </select>
            </div>
        </div>
        <h3 style="color:cyan; margin-top: 25px;">Gamer Card Slots</h3>
        <div id="gamerCardSlots" class="gamer-card-container"></div>
    </div>
</div>

<script>
// Firebase initialization (replace with your config)
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_BUCKET",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

let currentUser = null;
let blockedUsers = {}; // object with blocked UID keys
let allUsersCache = []; // cache of all users
const OWNER_UID = "OWNER_USER_ID"; // lightning-bolt CO-FOUNDER

// --- LOGIN / LOGOUT ---
function login() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).then(result => {
        currentUser = result.user;
        document.getElementById('loginPage').classList.add('hidden');
        document.getElementById('dashboard').classList.remove('hidden');
        document.getElementById('welcome').innerText = `Welcome, ${currentUser.displayName || currentUser.email}`;
        loadBlockedUsers();
        loadAllUsers();
        loadProfile();
    }).catch(console.error);
}

function logout() {
    auth.signOut().then(() => location.reload());
}

// --- TAB MANAGEMENT ---
function showTab(tab) {
    document.querySelectorAll('#dashboard > div, #profileTab, #viewProfileTab').forEach(el => el.classList.add('hidden'));
    switch(tab){
        case 'allUsers': document.getElementById('allUsersTab').classList.remove('hidden'); break;
        case 'search': document.getElementById('searchTab').classList.remove('hidden'); break;
        case 'requests': document.getElementById('requestsTab').classList.remove('hidden'); break;
        case 'friends': document.getElementById('friendsTab').classList.remove('hidden'); break;
        case 'messaging': document.getElementById('messagingTab').classList.remove('hidden'); break;
        case 'profile': document.getElementById('profileTab').classList.remove('hidden'); break;
        case 'viewProfile': document.getElementById('viewProfileTab').classList.remove('hidden'); break;
    }
}

// --- BLOCKED USERS ---
async function loadBlockedUsers() {
    const snapshot = await db.collection("blocks").where("blocker", "==", currentUser.uid).get();
    blockedUsers = {};
    snapshot.forEach(doc => { blockedUsers[doc.data().blocked] = true; });
}

// --- LOAD ALL USERS ---
async function loadAllUsers() {
    const snapshot = await db.collection('users').get();
    allUsersCache = [];
    snapshot.forEach(doc => {
        const data = doc.data();
        if(doc.id === currentUser.uid || blockedUsers[doc.id]) return;
        allUsersCache.push({id: doc.id, data});
    });
    renderAllUsers(allUsersCache);
}

// --- RENDER USER CARD ---
function renderUserCard(user) {
    const data = user.data;
    const usernameDisplay = data.username ? `@${data.username}` : data.nickname;
    const skillRating = data.skillRating || 1;
    const status = data.status || 'Online';
    let statusClass = 'online';
    if(status === 'Online') statusClass='online';
    else if(status==='In Game') statusClass='ingame';
    else if(status==='LFD') statusClass='lfd';
    let card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `<div class="card-content">
        <img src="${data.avatar || 'https://via.placeholder.com/50'}" class="avatar">
        <strong>${usernameDisplay}</strong> ${user.id === OWNER_UID ? '<span class="owner-badge-box">CO-FOUNDER</span>' : ''}
        <span class="skill-rating">${'⭐'.repeat(skillRating)}</span>
        <span class="status-indicator status-${statusClass}">${status}</span>
    </div>`;
    card.addEventListener('click', ()=>{ viewUserProfile(user.id); });
    return card;
}

// --- RENDER ALL USERS ---
function renderAllUsers(users){
    const container = document.getElementById('allUsersTab');
    container.innerHTML='';
    users.forEach(user=>{
        container.appendChild(renderUserCard(user));
    });
}

// --- VIEW USER PROFILE ---
async function viewUserProfile(uid) {
    showTab('viewProfile');
    const doc = await db.collection('users').doc(uid).get();
    if(!doc.exists) return;
    const data = doc.data();
    const usernameDisplay = data.username ? `@${data.username}` : data.nickname;
    document.getElementById('viewProfileContent').innerHTML = `
        <h2>${usernameDisplay} ${uid===OWNER_UID?'<span class="owner-badge-box">CO-FOUNDER</span>':''}</h2>
        <img src="${data.avatar||'https://via.placeholder.com/100'}" class="avatar" style="width:100px;height:100px;">
        <p>Bio: ${data.bio||'No bio'}</p>
        <p>Skill: ${'⭐'.repeat(data.skillRating||1)}</p>
        <p>Status: ${data.status||'Online'}</p>
    `;
}

// --- SEARCH FILTER ---
function filterSearchResults() {
    const query = document.getElementById('searchInput').value.toLowerCase();
    const statusFilter = document.getElementById('statusFilter').value;
    const minSkill = parseInt(document.getElementById('skillFilter').value);
    const filtered = allUsersCache.filter(({id,data})=>{
        if(blockedUsers[id]) return false;
        if(query && !((data.nickname||'').toLowerCase().includes(query) || (data.bio||'').toLowerCase().includes(query))) return false;
        if(statusFilter && data.status!==statusFilter) return false;
        if(minSkill>0 && (data.skillRating||0)<minSkill) return false;
        return true;
    });
    const container = document.getElementById('searchResults');
    container.innerHTML='';
    filtered.forEach(user=>{
        container.appendChild(renderUserCard(user));
    });
}

// --- PROFILE ---
async function loadProfile() {
    const doc = await db.collection('users').doc(currentUser.uid).get();
    if(!doc.exists) return;
    const data = doc.data();
    document.getElementById('profileAvatar').src = data.avatar || 'https://via.placeholder.com/80';
    document.getElementById('profileNickname').value = data.nickname || currentUser.uid;
    document.getElementById('profileBio').value = data.bio || '';
    document.getElementById('profileSkillRating').value = data.skillRating || 1;
    document.getElementById('profileStatus').value = data.status || 'Online';
    document.getElementById('usernameDisplay').innerText = data.username ? `@${data.username}` : 'Not Set';
}

function previewAvatar(input){
    if(input.files && input.files[0]){
        const reader = new FileReader();
        reader.onload = e => document.getElementById('profileAvatar').src = e.target.result;
        reader.readAsDataURL(input.files[0]);
    }
}

// --- CHANGE USERNAME ---
async function attemptUsernameChange() {
    const newUsername = document.getElementById('newUsernameInput').value.toLowerCase().trim();
    if(!/^[a-z0-9]{3,20}$/.test(newUsername)){
        document.getElementById('usernameMessage').innerText = 'Invalid format.';
        return;
    }
    const snap = await db.collection('users').where('username','==',newUsername).get();
    if(!snap.empty){ document.getElementById('usernameMessage').innerText='Username taken.'; return; }
    await db.collection('users').doc(currentUser.uid).update({username:newUsername});
    document.getElementById('usernameDisplay').innerText = `@${newUsername}`;
    document.getElementById('usernameMessage').innerText='Username updated!';
}

</script>

</body>
</html>
