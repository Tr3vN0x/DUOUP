<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr3vMedia TCG Interface: Collect & Engage</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        /* --- NEON LED THEME STYLES (Unchanged) --- */
        :root {
            --bg-dark: #0F1117;
            --neon-green: #00FF66;
            --neon-glow: 0 0 8px var(--neon-green), 0 0 15px var(--neon-green);
            --card-bg: #1B1E28;
            --text-light: #E0E0E0;
            --secondary-dark: #12151d;
            
            /* TCG Rarity Colors */
            --rarity-common: #6c757d;    /* Gray */
            --rarity-rare: #007bff;      /* Blue */
            --rarity-epic: #9c27b0;      /* Purple */
            --rarity-legendary: #ffc107; /* Gold */
        }

        body {
            font-family: 'Share Tech Mono', monospace, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh; 
            background-color: var(--bg-dark);
            color: var(--neon-green);
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-shadow: var(--neon-glow);
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        /* --- GENERAL UI STYLES (Updated) --- */
        .header-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .ui-button, .controls button, .pack-button {
            padding: 10px 20px; 
            font-size: 0.9em; 
            border: 2px solid var(--neon-green); 
            border-radius: 50px;
            cursor: pointer; 
            background-color: var(--card-bg); 
            color: var(--neon-green);
            box-shadow: 0 0 5px rgba(0, 255, 102, 0.7); 
            transition: all 0.2s; 
            text-transform: uppercase;
        }
        .pack-button {
            border-color: var(--rarity-legendary);
            color: var(--rarity-legendary);
            box-shadow: 0 0 8px var(--rarity-legendary);
        }
        .pack-button:hover {
            background-color: var(--rarity-legendary);
            color: var(--bg-dark);
        }
        
        /* --- CARD & SWIPE STYLES (Minor updates for TCG info) --- */
        .swipe-area {
            display: flex;
            gap: 50px;
            align-items: flex-start;
            margin-bottom: 30px;
        }
        .swipe-container {
            position: relative;
            width: 320px;
            height: 400px;
        }
        .card {
            /* ... existing styles ... */
            display: grid;
            grid-template-rows: 70% 30%; /* Image area and info area */
        }
        
        /* Stats Bar (NEW) */
        .card-stats {
            position: absolute;
            bottom: 110px; /* Above the info block */
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8em;
            text-shadow: 0 0 3px black;
        }
        .card-stats span {
            border: 1px solid white;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .rarity-border {
            border-color: var(--rarity-common);
        }
        .rarity-common { border-color: var(--rarity-common); }
        .rarity-rare { border-color: var(--rarity-rare); }
        .rarity-epic { border-color: var(--rarity-epic); }
        .rarity-legendary { border-color: var(--rarity-legendary); }


        /* --- PROFILE CONSOLE STYLES (Minor additions) --- */
        .profile-console {
            width: 450px;
            min-height: 500px;
            /* ... existing styles ... */
        }

        /* --- COLLECTION MODAL STYLES (NEW) --- */
        #collectionModal .modal-content {
            max-width: 900px;
            width: 90%;
            height: 80vh;
            display: flex;
            flex-direction: column;
        }
        .collection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            overflow-y: auto;
            padding-right: 10px; /* Space for scrollbar */
        }
        .collection-card {
            width: 100%;
            aspect-ratio: 1 / 1.4;
            border: 2px solid;
            border-radius: 6px;
            box-shadow: 0 0 5px rgba(0, 255, 102, 0.5);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            text-align: center;
            font-size: 0.7em;
            padding: 5px;
            background-color: var(--card-bg);
            cursor: pointer;
        }
        .collection-card img {
            width: 100%;
            height: 60%;
            object-fit: cover;
            border-radius: 4px;
        }
        .collection-card-info {
            line-height: 1.2;
            margin-top: 5px;
        }

    </style>
</head>
<body>

    <header>
        <h1>TR3VMEDIA // TCG ENGAGE</h1>
        <div class="header-controls">
            <button id="customizeBtn" class="ui-button">‚öôÔ∏è Custom Card</button>
            <button id="viewCollectionBtn" class="ui-button">üé¥ View Collection (<span id="collectionCount">0</span>)</button>
            <button id="openPackBtn" class="pack-button">‚ö° Open Pack (Free!)</button>
            <button id="loginBtn" class="ui-button">üîì Login/Logout</button>
        </div>
    </header>

    <div class="swipe-area">
        <div class="swipe-column">
            <div class="swipe-container">
                <div id="noMoreCards">
                    NO MORE MEDIA. REBOOTING SEQUENCE...
                </div>
            </div>
            <div class="controls">
                <button id="dislikeBtn">‚ùå SKIP</button>
                <button id="likeBtn">‚ù§Ô∏è ENGAGE (Collect)</button>
            </div>
        </div>

        <div id="profileConsole" class="profile-console">
            </div>
    </div>


    <div id="loginModal" class="modal-overlay" style="display: none;"><div class="modal-content"><h2 id="loginTitle">System Login</h2><form id="loginForm"><label for="username">User Handle:</label><input type="text" id="username" value="tr3vmedia" required><label for="password">Password (Mock):</label><input type="text" id="password" value="pass123" required><div class="modal-actions"><button type="submit" class="ui-button">Access System</button><button type="button" class="ui-button" onclick="closeLoginModal()">Abort</button></div></form><div id="logoutSection" style="display: none;"><p>Logged in as: <strong id="loggedInUser"></strong></p><div class="modal-actions"><button type="button" class="ui-button" onclick="logout()">Terminate Session</button></div></div></div></div>
    
    <div id="customizeModal" class="modal-overlay" style="display: none;"><div class="modal-content"><h2>Customize Your Card</h2><p style="color: red;">* Requires mock login to save changes.</p><form id="cardCustomizationForm"><label for="cardBirthday">Date of Birth (Sets Age):</label><input type="date" id="cardBirthday" max="2007-01-01" required><label for="cardTitle">Project Title:</label><input type="text" id="cardTitle" maxlength="30" required><label for="cardDesc">Description (Max 50 chars):</label><textarea id="cardDesc" maxlength="50" required></textarea><label for="cardMedia">Media URL (Placeholder):</label><input type="text" id="cardMedia" placeholder="https://picsum.photos/320/280?user=..." required> <div class="modal-actions"><button type="submit" class="ui-button">üíæ SAVE CARD</button><button type="button" class="ui-button" onclick="closeCustomizeModal()">CANCEL</button></div></form></div></div>
    
    <div id="mediaViewerModal" class="modal-overlay" style="display: none;"><div class="modal-content"><h2 id="viewerTitle">Loading Media...</h2><div class="media-container"></div><div id="viewerDescription" style="color: var(--text-light); margin-bottom: 20px;"></div><div class="viewer-nav-controls"><button id="prevMediaBtn" class="ui-button" disabled>‚ùÆ Previous</button><button id="nextMediaBtn" class="ui-button" disabled>Next ‚ùØ</button></div><div class="modal-actions"><button type="button" class="ui-button" onclick="closeMediaViewer()">CLOSE VIEWER</button></div></div></div>

    <div id="collectionModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2 id="collectionTitle">üé¥ USER COLLECTION TRACKER</h2>
            <div id="collectionFilter" style="margin-bottom: 15px; text-align: center;">
                <label>Sort by:</label>
                <select id="sortRarity" onchange="renderCollection()">
                    <option value="rarity">Rarity</option>
                    <option value="title">Title (A-Z)</option>
                    <option value="power">Power (High)</option>
                </select>
                <label style="margin-left: 20px;">Rarity Filter:</label>
                <select id="filterRarity" onchange="renderCollection()">
                    <option value="all">All</option>
                    <option value="Legendary">Legendary</option>
                    <option value="Epic">Epic</option>
                    <option value="Rare">Rare</option>
                    <option value="Common">Common</option>
                </select>
            </div>
            <div id="collectionGrid" class="collection-grid">
                </div>
            <div class="modal-actions" style="margin-top: 15px;">
                <button type="button" class="ui-button" onclick="closeCollectionModal()">CLOSE</button>
            </div>
        </div>
    </div>

    <script>
        // --- JAVASCRIPT LOGIC ---

        // Mock Database of Cards for packs (Now includes TCG stats)
        const PACK_CARD_POOL = [
            { id: 101, title: "Cyber-Glitch Audio", user: "@SynthWave", rarity: 'Common', type: 'Audio', power: 45, imageUrl: "https://picsum.photos/120/168?g=101", fullUrl: 'https://www.youtube.com/embed/Q5S-JjG6f3s?autoplay=1&mute=1' },
            { id: 102, title: "Deep Sea Code", user: "@HackerFish", rarity: 'Common', type: 'Code', power: 50, imageUrl: "https://picsum.photos/120/168?g=102", fullUrl: 'https://picsum.photos/600/400?g=102' },
            { id: 103, title: "Urban Sunset", user: "@CityScape", rarity: 'Rare', type: 'Art', power: 75, imageUrl: "https://picsum.photos/120/168?g=103", fullUrl: 'https://picsum.photos/600/400?g=103' },
            { id: 104, title: "Zero Day Exploit", user: "@GhostSec", rarity: 'Epic', type: 'Code', power: 90, imageUrl: "https://picsum.photos/120/168?g=104", fullUrl: 'https://picsum.photos/600/400?g=104' },
            { id: 105, title: "Quantum Dream", user: "@MindPilot", rarity: 'Rare', type: 'Art', power: 80, imageUrl: "https://picsum.photos/120/168?g=105", fullUrl: 'https://picsum.photos/600/400?g=105' },
            { id: 106, title: "Eternal Loops", user: "@LoopMaster", rarity: 'Legendary', type: 'Audio', power: 99, imageUrl: "https://picsum.photos/120/168?g=106", fullUrl: 'https://www.youtube.com/embed/s3yYvVw84e4?autoplay=1&mute=1' },
        ];
        
        // --- GLOBAL STATE ---
        let CARD_DATA = []; // No swipeable cards other than the user's
        let viewerHistory = [];
        let viewerHistoryIndex = -1;
        let currentCardIndex = 0;
        let isUserLoggedIn = false;

        // Load collection or initialize with an empty array
        let userCardsCollected = JSON.parse(localStorage.getItem('tcgCollection')) || [];
        
        // Custom user card (Updated to include TCG stats for the starter card)
        let userCardData = JSON.parse(localStorage.getItem('userCard')) || {
            id: 'user_custom', title: "My Custom Media Card", user: localStorage.getItem('userHandle') || "@Guest", 
            birthday: '2000-01-01', 
            description: "Customize this description in the modal!", bio: "A visual artist focused on neon cityscapes and synthwave aesthetics.",
            imageUrl: "https://picsum.photos/320/280?user=tr3vmedia",
            mediaType: 'image', fullUrl: 'https://picsum.photos/600/400?user=tr3vmedia',
            rarity: 'Starter', type: 'Profile', power: 70 
        };
        // Ensure user card is always in collection (as the starter)
        if (!userCardsCollected.find(c => c.id === 'user_custom')) {
            userCardsCollected.push(userCardData);
            localStorage.setItem('tcgCollection', JSON.stringify(userCardsCollected));
        }

        const swipeContainer = document.querySelector('.swipe-container');
        const profileConsole = document.getElementById('profileConsole');
        const collectionCountSpan = document.getElementById('collectionCount');
        const openPackBtn = document.getElementById('openPackBtn');
        const viewCollectionBtn = document.getElementById('viewCollectionBtn');
        const dislikeBtn = document.getElementById('dislikeBtn');
        const likeBtn = document.getElementById('likeBtn');


        // --- TCG PACK & COLLECTION LOGIC (NEW) ---

        function getCardRarityColor(rarity) {
            switch (rarity) {
                case 'Legendary': return 'var(--rarity-legendary)';
                case 'Epic': return 'var(--rarity-epic)';
                case 'Rare': return 'var(--rarity-rare)';
                case 'Starter': return 'var(--neon-green)';
                default: return 'var(--rarity-common)';
            }
        }
        
        function drawCardFromPool() {
            // Mock probability logic for drawing a card based on rarity
            const rand = Math.random();
            let rarityTarget;
            
            if (rand < 0.05) { rarityTarget = 'Legendary'; } // 5%
            else if (rand < 0.20) { rarityTarget = 'Epic'; }      // 15% (20% cumulative)
            else if (rand < 0.50) { rarityTarget = 'Rare'; }      // 30% (50% cumulative)
            else { rarityTarget = 'Common'; }                       // 50%

            const pool = PACK_CARD_POOL.filter(card => card.rarity === rarityTarget);
            
            // If the target rarity pool is empty, fall back to a random card from the whole pool
            if (pool.length === 0) {
                const fallbackIndex = Math.floor(Math.random() * PACK_CARD_POOL.length);
                return PACK_CARD_POOL[fallbackIndex];
            }
            
            const cardIndex = Math.floor(Math.random() * pool.length);
            // Deep copy the card to ensure unique instance if needed later
            return JSON.parse(JSON.stringify(pool[cardIndex]));
        }

        function openPack() {
            if (!isUserLoggedIn) {
                alert("ACCESS DENIED: Please login to open packs and track your collection.");
                return;
            }

            const cardsInPack = 3;
            const newCards = [];
            for (let i = 0; i < cardsInPack; i++) {
                newCards.push(drawCardFromPool());
            }

            let message = "PACK OPENED! You received:\n\n";
            newCards.forEach(card => {
                userCardsCollected.push(card);
                message += `[${card.rarity.toUpperCase()}] ${card.title} (POWER: ${card.power})\n`;
            });

            localStorage.setItem('tcgCollection', JSON.stringify(userCardsCollected));
            updateCollectionCount();

            alert(message);
            renderCollection(); // Update collection modal if open
        }

        function updateCollectionCount() {
            // Subtract 1 because the user's starter card is always present
            collectionCountSpan.textContent = userCardsCollected.length;
        }

        function renderCollection() {
            const grid = document.getElementById('collectionGrid');
            const sortBy = document.getElementById('sortRarity').value;
            const filterRarity = document.getElementById('filterRarity').value;
            
            let displayCards = [...userCardsCollected];

            // 1. Filtering
            if (filterRarity !== 'all') {
                displayCards = displayCards.filter(card => card.rarity === filterRarity);
            }

            // 2. Sorting
            displayCards.sort((a, b) => {
                if (sortBy === 'title') {
                    return a.title.localeCompare(b.title);
                }
                if (sortBy === 'power') {
                    return b.power - a.power; // Descending
                }
                if (sortBy === 'rarity') {
                    const rarityOrder = ['Legendary', 'Epic', 'Rare', 'Starter', 'Common'];
                    return rarityOrder.indexOf(a.rarity) - rarityOrder.indexOf(b.rarity);
                }
                return 0;
            });
            
            let html = '';
            if (displayCards.length === 0) {
                html = '<p style="color: var(--rarity-common); text-align: center; width: 100%;">No cards match the filter criteria. Open a pack!</p>';
            } else {
                html = displayCards.map(card => {
                    const color = getCardRarityColor(card.rarity);
                    return `
                        <div class="collection-card" style="border-color: ${color};" onclick="viewCollectedCard(${card.id})">
                            <img src="${card.imageUrl}" alt="${card.title}">
                            <div class="collection-card-info">
                                <strong>${card.title}</strong><br>
                                <span style="color: ${color};">${card.rarity.toUpperCase()}</span><br>
                                ${card.power ? `PWR: ${card.power}` : ''} | ${card.type || ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            grid.innerHTML = html;
        }

        function viewCollectedCard(id) {
            // Find the full data of the collected card
            const cardData = userCardsCollected.find(c => c.id == id);
            
            if (cardData) {
                // To avoid confusing the user, we will use the existing viewer modal
                alert(`Viewing Card ID ${id}: ${cardData.title} by ${cardData.user}.\n\nThis would normally open the full media in the viewer modal.`);
                // If you wanted to fully integrate it: showMediaViewer(cardData);
            }
        }
        
        function openCollectionModal() {
            if (!isUserLoggedIn) {
                alert("ACCESS DENIED: Please login to view your collection.");
                return;
            }
            renderCollection();
            document.getElementById('collectionModal').style.display = 'flex';
        }
        
        function closeCollectionModal() {
            document.getElementById('collectionModal').style.display = 'none';
        }

        // --- CORE LOGIC (Modified to show TCG stats on user card) ---

        function getCardAge(data) {
            if (data.birthday) { return calculateAge(data.birthday); }
            return data.age || 'N/A';
        }

        function calculateAge(birthday) { /* ... same logic ... */
            const birthDate = new Date(birthday);
            const today = new Date();
            if (isNaN(birthDate)) return 'N/A';
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDifference = today.getMonth() - birthDate.getMonth();
            if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return (age >= 0 && age < 120) ? age : 'N/A';
        }

        function createCard(data) {
            const card = document.createElement('div');
            // Get TCG data for the card
            const rarity = data.rarity || 'Common';
            const type = data.type || 'Media';
            const power = data.power || 50;
            const ageDisplay = getCardAge(data);
            const rarityColor = getCardRarityColor(rarity);

            card.className = `card rarity-border`;
            card.style.borderColor = rarityColor;
            card.dataset.id = data.id;

            card.innerHTML = `
                <div class="card-header" style="background-color: ${rarityColor}; color: var(--bg-dark);">${data.user.toUpperCase()}, ${ageDisplay}</div>
                <img class="card-image" src="${data.imageUrl}" alt="${data.title}">
                
                <div class="card-stats">
                    <span style="border-color: ${rarityColor};">TYPE: ${type.toUpperCase()}</span>
                    <span style="border-color: ${rarityColor};">RARITY: ${rarity.toUpperCase()}</span>
                    <span style="border-color: ${rarityColor};">POWER: ${power}</span>
                </div>

                <div class="card-info">
                    <h3>${data.title.toUpperCase()}</h3>
                    <p>${data.description}</p>
                </div>
            `;
            return card;
        }

        function loadNextCard() {
            if (swipeContainer.children.length === 0) {
                 // ONLY LOAD USER CARD:
                const userCard = createCard(userCardData);
                swipeContainer.appendChild(userCard);
                addSwipeListeners(userCard);
                document.getElementById('noMoreCards').style.display = 'none';
                currentCardIndex = 1; 
            } else if (swipeContainer.children.length === 1 && swipeContainer.children[0].className.includes('card')) {
                document.getElementById('noMoreCards').style.display = 'block';
            }
        }
        
        function swipeCard(card, direction) { 
            card.classList.add(`swipe-${direction}`);
            
            if (direction === 'right') {
                // In a TCG context, 'Engage' could mean 'Collect' or 'Use in Battle'
                alert("Engagement logged! This card is always in your collection.");
            }
            setTimeout(() => {
                card.remove();
                loadNextCard(); 
            }, 300);
        }
        
        function addSwipeListeners(card) { /* ... drag/touch logic ... */
            let startX, isDragging = false;
            
            function handleStart(e) { e.preventDefault(); isDragging = true; startX = e.clientX || e.touches[0].clientX; card.style.transition = 'none'; }
            function handleMove(e) { if (!isDragging) return; const currentX = e.clientX || e.touches[0].clientX; const deltaX = currentX - startX; const rotate = deltaX / 20; card.style.transform = `translateX(${deltaX}px) rotate(${rotate}deg)`; }
            function handleEnd(e) {
                if (!isDragging) return; isDragging = false; card.style.transition = 'transform 0.3s ease-out, opacity 0.3s ease-out';
                const finalX = e.clientX || e.changedTouches[0].clientX; const deltaX = finalX - startX; const threshold = 100;
                if (deltaX > threshold) { swipeCard(card, 'right'); } else if (deltaX < -threshold) { swipeCard(card, 'left'); } else { card.style.transform = 'translate(0) rotate(0)'; }
            }
            card.addEventListener('mousedown', handleStart); card.addEventListener('touchstart', handleStart);
            document.addEventListener('mousemove', handleMove); document.addEventListener('touchmove', handleMove);
            document.addEventListener('mouseup', handleEnd); document.addEventListener('touchend', handleEnd);
            card.addEventListener('remove', () => { /* Cleanup listeners */});
        }

        // --- 4. PROFILE CONSOLE LOGIC (Updated to show TCG stats) ---
        
        function generateNewMedia() {
            /* ... same logic for prompt and image generation ... */
            const prompt = document.getElementById('mediaPrompt').value.trim();
            if (prompt.length < 10) {
                alert("Prompt too short. Provide a detailed prompt (min 10 chars) for the Media Engine.");
                return;
            }
            const newImage = `https://picsum.photos/320/280?seed=${Date.now()}`;
            userCardData.imageUrl = newImage;
            userCardData.description = `Generated by prompt: "${prompt.substring(0, 40)}..."`;

            localStorage.setItem('userCard', JSON.stringify(userCardData));
            alert(`[AI Engine] Media generated for prompt: "${prompt}"! Card image and description updated.`);
            window.location.reload(); 
        }

        function renderProfileConsole() {
            const data = userCardData;
            const ageDisplay = getCardAge(data);
            const rarityColor = getCardRarityColor(data.rarity);
            
            // Generate the list of matching users HTML
            const MOCK_ENGAGEMENTS = [
                { user: "@cyber_punk", match: 85, media: "Code" },
                { user: "@neon_dreams", match: 62, media: "Art" },
                { user: "@trance_code", match: 51, media: "Audio" },
            ];

            const matchHtml = MOCK_ENGAGEMENTS.map(match => `
                <div class="match-item">
                    <span>${match.user} (${match.media})</span>
                    <span class="match-percent" style="color: ${rarityColor}; text-shadow: 0 0 3px ${rarityColor};">${match.match}% Match</span>
                </div>
            `).join('');

            profileConsole.innerHTML = `
                <div class="console-title">üéØ TCG PROFILE CONSOLE: ${data.user.toUpperCase()}</div>

                <div class="match-list-title" style="color: ${rarityColor};">MY STARTER CARD STATS:</div>
                <div class="my-card-static" style="border-color: ${rarityColor};">
                    <img src="${data.imageUrl}" alt="User Media">
                    <div class="my-card-info">
                        <strong>Type:</strong> ${data.type.toUpperCase()}<br>
                        <strong>Rarity:</strong> <span style="color: ${rarityColor};">${data.rarity.toUpperCase()}</span><br>
                        <strong>Power:</strong> ${data.power}<br>
                        <hr style="border-color: rgba(0, 255, 102, 0.3);">
                        <strong>Bio:</strong> ${data.bio || 'No bio set. Customize!'}
                    </div>
                </div>

                <div class="match-list-title">LATEST ENGAGEMENT MATCHES</div>
                <div class="match-list">
                    ${matchHtml}
                </div>

                <div class="bio-area">
                    <div class="match-list-title">MEDIA GENERATION ENGINE (AI PROMPT)</div>
                    <label for="mediaPrompt" style="color: var(--neon-green); font-size: 0.9em;">Prompt to generate new card image:</label>
                    <textarea id="mediaPrompt" placeholder="Example: A dark, rainy cyberpunk street corner with a glowing neon sign of a dragon..."></textarea>
                    <button class="ui-button generate-btn" onclick="generateNewMedia()">üé® GENERATE NEW MEDIA</button>
                </div>
            `;
        }


        // --- UTILITY & INIT LOGIC ---
        
        function updateLoginState(handle, isLoggedIn) { /* ... same logic ... */
            isUserLoggedIn = isLoggedIn;
            localStorage.setItem('isLoggedIn', isLoggedIn);
            localStorage.setItem('userHandle', handle);
            document.getElementById('loginBtn').textContent = isLoggedIn ? `üîí LOGOUT (${handle})` : 'üîì LOGIN/LOGOUT';
            // Trigger console update on login/logout
            renderProfileConsole();
        }
        
        // --- EVENT LISTENERS ---
        openPackBtn.addEventListener('click', openPack);
        viewCollectionBtn.addEventListener('click', openCollectionModal);
        document.getElementById('dislikeBtn').addEventListener('click', () => { const topCard = swipeContainer.querySelector('.card:last-child'); if (topCard) swipeCard(topCard, 'left'); });
        document.getElementById('likeBtn').addEventListener('click', () => { const topCard = swipeContainer.querySelector('.card:last-child'); if (topCard) swipeCard(topCard, 'right'); });
        
        // --- INITIALIZATION ---
        function init() {
            const handle = localStorage.getItem('userHandle') || '@Guest';
            const loggedIn = localStorage.getItem('isLoggedIn') === 'true';
            updateLoginState(handle, loggedIn);
            loadNextCard();
            updateCollectionCount();
            renderProfileConsole();
        }
        
        init();

    </script>
</body>
</html>
