<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Duoup ‚Äì Professional Gaming Network</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<style>
:root {
  --bg: #0F0F1A;
  --panel: #1A1A2E;
  --cyan: #00FFFF;
  --pink: #FF3366;
  --text: #C0C0D8;
  --radius: 10px;
}

* { box-sizing:border-box;margin:0;padding:0; }
body { font-family: Inter, Segoe UI, sans-serif; background: var(--bg); color: var(--text); min-height:100vh; }

nav { display:none; justify-content:space-between; padding:15px 30px; background: var(--panel); border-bottom:2px solid var(--cyan); }
nav span { cursor:pointer; margin-left:20px; }

section { display:none; padding:30px; }
.card { background: var(--panel); padding:25px; border-radius: var(--radius); max-width:400px; margin:auto; }
input, select { width:100%; margin-bottom:15px; padding:12px; background:#0F0F1A; border:1px solid #333; color:#fff; border-radius: var(--radius); }
button { width:100%; padding:12px; border:none; border-radius: var(--radius); font-weight:bold; cursor:pointer; }
.btn-primary { background: var(--pink); color:#000; }
.btn-secondary { background: var(--cyan); color:#000; }
.player-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap:20px; }
.player { background: var(--panel); padding:15px; border-radius: var(--radius); }
</style>
</head>
<body>

<nav id="nav">
  <strong style="color:var(--cyan)">üì° Duoup</strong>
  <div>
    <span onclick="showView('home')">Home</span>
    <span onclick="logout()">Logout</span>
  </div>
</nav>

<!-- AUTH -->
<section id="auth">
  <div class="card">
    <h2 style="color:var(--cyan);margin-bottom:20px;">Sign In</h2>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button class="btn-primary" onclick="emailSignup()">Continue</button>
    <br><br>
    <button class="btn-secondary" onclick="googleSignIn()">
      <i class="fab fa-google"></i> Google Sign In
    </button>
  </div>
</section>

<!-- ONBOARDING -->
<section id="onboarding">
  <div class="card">
    <h2 style="color:var(--cyan);margin-bottom:15px;">Quick Setup</h2>
    <input id="username" placeholder="Gamertag">
    <input id="game" placeholder="Main Game">
    <select id="availability">
      <option value="">Availability</option>
      <option>Casual</option>
      <option>Competitive</option>
      <option>Anytime</option>
    </select>
    <button class="btn-primary" onclick="completeOnboarding()">Enter Network</button>
  </div>
</section>

<!-- HOME -->
<section id="home">
  <div style="max-width:400px;margin-bottom:20px;">
    <button id="toggle-lfd" class="btn-secondary">Looking for Duo: ON</button>
  </div>
  <h2 style="color:var(--cyan);margin-bottom:20px;">Live Duoup Feed</h2>
  <div class="player-grid" id="feed"></div>
</section>

<script>
/* üî• FIREBASE CONFIG */
firebase.initializeApp({
  apiKey: "AIzaSyDVHxatohLvJNqIHXjf1ZXdmmWX5W1EpNw",
  authDomain: "duoup-cfae6.firebaseapp.com",
  projectId: "duoup-cfae6"
});

const auth = firebase.auth();
const db = firebase.firestore();

const views = {
  auth: document.getElementById('auth'),
  onboarding: document.getElementById('onboarding'),
  home: document.getElementById('home')
};

const toggleBtn = document.getElementById('toggle-lfd');
const feed = document.getElementById('feed');

function showView(id){
  Object.values(views).forEach(v=>v.style.display='none');
  views[id].style.display='block';
  document.getElementById('nav').style.display = id==='auth'?'none':'flex';
}

/* üîê AUTH STATE */
auth.onAuthStateChanged(async user => {
  if(!user){ showView('auth'); return; }

  const ref = db.collection('users').doc(user.uid);
  const doc = await ref.get();

  if(!doc.exists){
    await ref.set({
      uid: user.uid,
      username: user.displayName||'',
      game:'',
      availability:'',
      onboarded:false,
      lookingForDuo:true,
      created:firebase.firestore.FieldValue.serverTimestamp()
    });
    showView('onboarding');
    return;
  }

  const data = doc.data();
  if(!data.onboarded){ showView('onboarding'); return; }

  updateToggleUI(data.lookingForDuo);
  showView('home');
  loadFeed();
});

/* ‚úâÔ∏è EMAIL SIGNUP */
async function emailSignup(){
  const e = document.getElementById('email').value;
  const p = document.getElementById('password').value;
  if(!e||!p) return alert('Email & password required');
  try { await auth.createUserWithEmailAndPassword(e,p); } catch(err){ alert(err.message); }
}

/* üîë GOOGLE SIGN IN */
async function googleSignIn(){
  try { await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); } 
  catch(err){ alert(err.message); }
}

/* üß≠ COMPLETE ONBOARDING */
async function completeOnboarding(){
  const user = auth.currentUser;
  const uname = document.getElementById('username').value;
  const game = document.getElementById('game').value;
  const avail = document.getElementById('availability').value;
  if(!uname||!game||!avail) return alert('Fill all fields');
  await db.collection('users').doc(user.uid).update({
    username: uname,
    game: game,
    availability: avail,
    onboarded:true,
    lookingForDuo:true
  });
  updateToggleUI(true);
  showView('home');
  loadFeed();
}

/* üîÑ LOOKING FOR DUO TOGGLE */
async function updateToggleUI(state){
  toggleBtn.textContent = `Looking for Duo: ${state?'ON':'OFF'}`;
  toggleBtn.style.backgroundColor = state ? 'var(--cyan)':'var(--panel)';
}

async function toggleLFD(){
  const ref = db.collection('users').doc(auth.currentUser.uid);
  const doc = await ref.get();
  const current = doc.data()?.lookingForDuo ?? true;
  await ref.update({ lookingForDuo: !current });
  updateToggleUI(!current);
}

toggleBtn.onclick = toggleLFD;

/* üì° FEED */
async function loadFeed(){
  feed.innerHTML = '<p style="color:var(--cyan)">Loading...</p>';
  try{
    const snap = await db.collection('users')
      .where('uid','!=',auth.currentUser.uid)
      .where('lookingForDuo','==',true)
      .limit(12)
      .get();
    feed.innerHTML='';
    if(snap.empty){ feed.innerHTML='<p>No users currently looking for Duo.</p>'; return; }
    snap.forEach(doc=>{
      const u = doc.data();
      feed.innerHTML += `
        <div class="player">
          <strong>${u.username}</strong>
          <p>${u.game}</p>
          <small>${u.availability}</small>
        </div>
      `;
    });
  }catch(err){ feed.innerHTML='<p>Error loading feed.</p>'; console.error(err);}
}

/* üö™ LOGOUT */
function logout(){ auth.signOut(); }
</script>
</body>
</html>
